---
import BaseLayout from "@layouts/BaseLayout.astro";
import ProjectCard from "@components/ProjectCard.astro";
import { projects } from "@data/projects";
---
<BaseLayout
  title="CURATIONS Projects"
  description="Card-based directory of Human Ã— AI community builds."
>
  <section class="mx-auto max-w-6xl px-6 py-16">
    <header class="mb-12 space-y-4">
      <p class="text-xs uppercase tracking-[0.35em] text-ink/60">Open Source Showcase</p>
      <h1 class="font-display text-5xl uppercase tracking-[0.35em]">Project Directory</h1>
      <p class="max-w-3xl text-sm leading-relaxed text-ink/70">
        Explore the builds powering the CURATIONS ecosystem. Each card links to live repos, status updates, and deep dives.
      </p>
    </header>
    <div class="grid gap-8 md:grid-cols-2">
      {projects.map((project) => (
        <ProjectCard project={project} />
      ))}
    </div>
  </section>

  <script>
    // Load live vote counts for all projects
    async function loadLiveVotes() {
      try {
        const response = await fetch('/api/votes');
        if (response.ok) {
          const votes = await response.json();
          
          // Update all vote buttons with live counts
          document.querySelectorAll('[data-vote-button]').forEach(button => {
            const id = button.dataset.id;
            if (id && votes[id] !== undefined) {
              const countEl = button.querySelector('.vote-count');
              const currentCount = votes[id];
              button.dataset.count = String(currentCount);
              if (countEl) countEl.textContent = String(currentCount);
            }
          });
        }
      } catch (error) {
        console.error('Failed to load live vote counts:', error);
      }
    }

    // Load data when page is ready
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', loadLiveVotes);
    } else {
      loadLiveVotes();
    }
  </script>
</BaseLayout>
